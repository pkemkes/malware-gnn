# Master's Thesis: Malware Classification in Heterogeneous Graph Databases using Graph Neural Networks - Implementation

## Disclaimer:
This repository contains the code used for my Master's Thesis. It is not built to work on any data and highly depends on the data format used in the thesis. This repository contains detailed information on the format. Furthermore, this code still needs a lot of work to be generally usable for the public. The intention of publicizing it here is merely to show the inner workings of the thesis more clearly.

## Preconditions
- (optional) create a new virtual environment
- Install required packages by performing the following steps:
    - install from requirements.txt:
      ``` bash 
      pip install -r requirements.txt
      ```
    - install torch
      ``` bash
      pip install torch==1.10.0+cu113 torchvision==0.11.1+cu113 torchaudio===0.10.0+cu113 -f https://download.pytorch.org/whl/cu113/torch_stable.html
      ```
    - install torch-geometric with one of the following commands, depending on whether your system has a CUDA GPU or not:

      ``` bash
      # cuda
      pip install torch-scatter torch-sparse torch-cluster torch-spline-conv torch-geometric -f https://data.pyg.org/whl/torch-1.10.0+cu113.html
      # cpu:
      pip install torch-scatter torch-sparse torch-cluster torch-spline-conv torch-geometric -f https://data.pyg.org/whl/torch-1.10.0+cpu.html
      ```
- Add the location of this repository to your PYTHONPATH to make its modules available
- Make sure to always use the `malware-gnn` directory as the current working directory when running the scripts.

## Data format
The data used as input is expected to represent subgraphs of a large graph database of malware analysis information. These subgraphs are expected to have the following properties:
- undirected
- self-loop on every vertex
- features only on vertices with identical dimension on all of them
- created from networkx graphs by using [networkx.readwrite.json_graph.node_link_data](https://networkx.org/documentation/stable/reference/readwrite/generated/networkx.readwrite.json_graph.node_link_data.html).

Further information on how to how to generate these subgraphs can be found in the [thesis](link_to.pdf). **TODO: ADD LINK TO PDF AFTER FINISHING WRITING.**

You can also find example data in the `data/[binary|multiclass]/raw` directories and the code that generated this data in the `scripts` directory of this repository.

## Preprocessing
Before using the subgraphs as input, they need to be preprocessed. This step is not performed when loading the data with the dataclass due to performance enhancements. For this, use the `preprocess_[binary|multiclass].py` scripts in the `scripts` directory.

## Training
Training on preprocessed data can be run with the `train_[binary|multiclass].py` scripts in the `scripts` directory.

## Testing
The trained models can be tested with the `test_[binary|multiclass].py` scripts in the `scripts` directory.

## Comparison with MajorityVoter
A simple classifier that chooses the predicted label by the majority in the subgraphs has been developed as a baseline. To use this on preprocessed data, the `vote_[binary|multiclass].py` scripts in the `scripts` directory can be used.

## Output
If not changed, all output can be found in the `output` directory that is created after running any script.